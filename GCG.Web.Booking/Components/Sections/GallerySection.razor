@inject IJSRuntime JS

<section id="gallery" class="gallery-section">
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="pt-12">

        <!-- Encabezado de la sección -->
        <div class="section-header" data-aos="fade-up">
            <MudText Typo="Typo.h3" Align="Align.Center" Class="section-title">
                Galería
            </MudText>
            <MudText Typo="Typo.body1" Align="Align.Center" Class="section-subtitle">
                Descubre cada rincón de tu próximo refugio tropical
            </MudText>
        </div>

        <!-- Filtros de categoría -->
        <div class="gallery-filters" data-aos="fade-up" data-aos-delay="100">
            <MudChipSet T="string"
                        @bind-SelectedValue="selectedFilter"
                        Mandatory="true"
                        Filter="true"
                        Class="justify-center">

                <MudChip T="string"
                         Value="@("all")"
                         Color="Color.Primary"
                         Variant="Variant.Outlined">
                    Todas
                </MudChip>

                @foreach (var category in GalleryCategories)
                {
                    <MudChip T="string"
                             Value="@category.Id"
                             Color="Color.Primary"
                             Variant="Variant.Outlined"
                             @key="category.Id">
                        @category.Name
                    </MudChip>
                }
            </MudChipSet>
        </div>

        <!-- Grid de imágenes con PhotoSwipe -->
        <div id="pswp-gallery" class="gallery-grid" data-aos="fade-up" data-aos-delay="200">
            @foreach (var image in FilteredImages)
            {
                <a href="@image.FullUrl"
                   data-pswp-width="@image.Width"
                   data-pswp-height="@image.Height"
                   class="gallery-item"
                   data-aos="zoom-in"
                   data-aos-delay="@GetDelay()"
                   target="_blank"
                   rel="noreferrer">
                    <div class="image-wrapper">
                        <MudImage Src="@image.ThumbUrl"
                                  Alt="@image.Caption"
                                  ObjectFit="ObjectFit.Cover"
                                  Class="gallery-image" />
                        <div class="image-overlay">
                            <div class="overlay-content">
                                <MudIcon Icon="@Icons.Material.Filled.ZoomIn"
                                         Size="Size.Large"
                                         Class="zoom-icon" />
                                <MudText Typo="Typo.subtitle1" Class="image-caption">
                                    @image.Caption
                                </MudText>
                                <MudChip T="string"
                                         Size="Size.Small"
                                         Color="Color.Secondary"
                                         Class="category-tag">
                                    @image.CategoryName
                                </MudChip>
                            </div>
                        </div>
                    </div>
                </a>
            }
        </div>

        <!-- Mensaje cuando no hay resultados -->
        @if (!FilteredImages.Any())
        {
            <div class="no-results" data-aos="fade-up">
                <MudIcon Icon="@Icons.Material.Filled.ImageNotSupported"
                         Size="Size.Large"
                         Color="Color.Default"
                         Class="mb-3" />
                <MudText Typo="Typo.h6" Color="Color.Default">
                    No hay imágenes en esta categoría
                </MudText>
            </div>
        }

        <!-- CTA al final -->
        <div class="cta-container" data-aos="fade-up" data-aos-delay="300">
            <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-3">
                ¿Te gustó lo que viste?
            </MudText>
            <MudText Typo="Typo.body1" Align="Align.Center" Color="Color.Default" Class="mb-4">
                Reserva ahora y vive esta experiencia única en persona
            </MudText>
            <MudStack Row="true"
                      AlignItems="AlignItems.Center"
                      Justify="Justify.Center"
                      Spacing="3">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Primary"
                           Size="Size.Large"
                           StartIcon="@Icons.Material.Filled.CalendarMonth"
                           Href="#booking"
                           Class="pulse">
                    Ver Disponibilidad
                </MudButton>
            </MudStack>
        </div>

    </MudContainer>
</section>
<style>
    /*=========================================
          =           GALLERY SECTION           =
          =========================================*/

    .gallery-section {
        background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%) !important;
        padding: 2rem 0;
    }

    .section-header {
        margin-bottom: 3rem;
        text-align: center;
    }

    .section-title {
        font-weight: 700;
        color: #023047;
        margin-bottom: 1rem;
        font-size: clamp(2rem, 5vw, 3rem);
    }

    .section-subtitle {
        color: #666;
        max-width: 600px;
        margin: 0 auto;
        font-size: clamp(1rem, 2vw, 1.125rem);
    }

    /* Filtros */
    .gallery-filters {
        display: flex;
        justify-content: center;
        margin-bottom: 3rem;
    }

    .justify-center {
        justify-content: center;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    /* Grid de galería */
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .gallery-item {
        position: relative;
        display: block;
        overflow: hidden;
        border-radius: 16px;
        aspect-ratio: 4/3;
        cursor: pointer;
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 28px rgba(33, 158, 188, 0.3);
        }

    .image-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }

    .gallery-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }

    .gallery-item:hover .gallery-image {
        transform: scale(1.1);
    }

    /* Overlay */
    .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient( to top, rgba(2, 48, 71, 0.95) 0%, rgba(2, 48, 71, 0.7) 50%, rgba(2, 48, 71, 0) 100% );
        opacity: 0;
        transition: opacity 0.3s ease;
        display: flex;
        align-items: flex-end;
        padding: 1.5rem;
    }

    .gallery-item:hover .image-overlay {
        opacity: 1;
    }

    .overlay-content {
        width: 100%;
        transform: translateY(20px);
        transition: transform 0.3s ease;
    }

    .gallery-item:hover .overlay-content {
        transform: translateY(0);
    }

    .zoom-icon {
        color: white;
        margin-bottom: 0.5rem;
    }

    .image-caption {
        color: white;
        font-weight: 600;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .category-tag {
        background: rgba(255, 183, 3, 0.9) !important;
        color: #023047 !important;
        font-weight: 600;
    }

    /* No results */
    .no-results {
        text-align: center;
        padding: 4rem 2rem;
        color: #666;
    }

    /* CTA final */
    .cta-container {
        margin-top: 4rem;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, rgba(33, 158, 188, 0.1) 0%, rgba(255, 183, 3, 0.1) 100%);
        border-radius: 20px;
        text-align: center;
    }

    /* Animación pulse */
    @@keyframes pulse {
        0%, 100% {
            box-shadow: 0 0 0 0 rgba(33, 158, 188, 0.7);
        }

        50% {
            box-shadow: 0 0 0 10px rgba(33, 158, 188, 0);
        }
    }

    .pulse {
        animation: pulse 2s infinite;
    }

    /* Responsive */
    @@media (max-width: 960px) {
        .gallery-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }

        .gallery-section {
            padding: 3rem 0;
        }

        .section-header {
            margin-bottom: 2rem;
        }

        .gallery-filters {
            margin-bottom: 2rem;
        }
    }

    @@media (max-width: 600px) {
        .gallery-grid {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .gallery-item {
            border-radius: 12px;
        }

        .image-overlay {
            padding: 1rem;
        }

        .image-caption {
            font-size: 0.875rem;
        }

        .cta-container {
            margin-top: 2rem;
            padding: 2rem 1rem;
        }
    }
</style>

@code {
    private string selectedFilter = "all";
    private int _delayCounter = 0;

    // Categorías de galería
    private record GalleryCategory(string Id, string Name);

    private List<GalleryCategory> GalleryCategories = new()
    {
        new GalleryCategory("exterior", "Exteriores"),
        new GalleryCategory("habitaciones", "Habitaciones"),
        new GalleryCategory("piscina", "Piscina"),
        new GalleryCategory("playa", "Playa"),
        new GalleryCategory("cocina", "Cocina & Comedor"),
        new GalleryCategory("areas", "Áreas Comunes")
    };

    // Modelo de imagen
    private record GalleryImage(
        string Id,
        string CategoryId,
        string CategoryName,
        string Caption,
        string ThumbUrl,
        string FullUrl,
        int Width,
        int Height
    );

    // Datos mock de imágenes (URLs verificadas de Picsum)
    private List<GalleryImage> AllImages = new()
    {
        // Exteriores
        new GalleryImage("img-1", "exterior", "Exteriores", "Vista frontal del rancho",
            "https://picsum.photos/id/1015/800/600", "https://picsum.photos/id/1015/1920/1280", 1920, 1280),
        new GalleryImage("img-2", "exterior", "Exteriores", "Jardín tropical",
            "https://picsum.photos/id/152/800/600", "https://picsum.photos/id/152/1920/1280", 1920, 1280),
        new GalleryImage("img-3", "exterior", "Exteriores", "Área de BBQ",
            "https://picsum.photos/id/225/800/600", "https://picsum.photos/id/225/1920/1280", 1920, 1280),

        // Habitaciones
        new GalleryImage("img-4", "habitaciones", "Habitaciones", "Habitación principal",
            "https://picsum.photos/id/1024/800/600", "https://picsum.photos/id/1024/1920/1280", 1920, 1280),
        new GalleryImage("img-5", "habitaciones", "Habitaciones", "Habitación con vista al mar",
            "https://picsum.photos/id/1031/800/600", "https://picsum.photos/id/1031/1920/1280", 1920, 1280),
        new GalleryImage("img-6", "habitaciones", "Habitaciones", "Suite con balcón",
            "https://picsum.photos/id/1041/800/600", "https://picsum.photos/id/1041/1920/1280", 1920, 1280),

        // Piscina
        new GalleryImage("img-7", "piscina", "Piscina", "Piscina infinity",
            "https://picsum.photos/id/136/800/600", "https://picsum.photos/id/136/1920/1280", 1920, 1280),
        new GalleryImage("img-8", "piscina", "Piscina", "Área de descanso junto a la piscina",
            "https://picsum.photos/id/164/800/600", "https://picsum.photos/id/164/1920/1280", 1920, 1280),
        new GalleryImage("img-9", "piscina", "Piscina", "Atardecer en la piscina",
            "https://picsum.photos/id/146/800/600", "https://picsum.photos/id/146/1920/1280", 1920, 1280),

        // Playa
        new GalleryImage("img-10", "playa", "Playa", "Playa privada",
            "https://picsum.photos/id/13/800/600", "https://picsum.photos/id/13/1920/1280", 1920, 1280),
        new GalleryImage("img-11", "playa", "Playa", "Kayaks disponibles",
            "https://picsum.photos/id/37/800/600", "https://picsum.photos/id/37/1920/1280", 1920, 1280),
        new GalleryImage("img-12", "playa", "Playa", "Hamacas frente al mar",
            "https://picsum.photos/id/77/800/600", "https://picsum.photos/id/77/1920/1280", 1920, 1280),

        // Cocina & Comedor
        new GalleryImage("img-13", "cocina", "Cocina & Comedor", "Cocina completamente equipada",
            "https://picsum.photos/id/175/800/600", "https://picsum.photos/id/175/1920/1280", 1920, 1280),
        new GalleryImage("img-14", "cocina", "Cocina & Comedor", "Comedor con vista panorámica",
            "https://picsum.photos/id/198/800/600", "https://picsum.photos/id/198/1920/1280", 1920, 1280),
        new GalleryImage("img-15", "cocina", "Cocina & Comedor", "Bar y área social",
            "https://picsum.photos/id/292/800/600", "https://picsum.photos/id/292/1920/1280", 1920, 1280),

        // Áreas Comunes
        new GalleryImage("img-16", "areas", "Áreas Comunes", "Sala de estar",
            "https://picsum.photos/id/447/800/600", "https://picsum.photos/id/447/1920/1280", 1920, 1280),
        new GalleryImage("img-17", "areas", "Áreas Comunes", "Terraza techada",
            "https://picsum.photos/id/342/800/600", "https://picsum.photos/id/342/1920/1280", 1920, 1280),
        new GalleryImage("img-18", "areas", "Áreas Comunes", "Zona de juegos",
            "https://picsum.photos/id/274/800/600", "https://picsum.photos/id/274/1920/1280", 1920, 1280),
    };

    // Imágenes filtradas
    private IEnumerable<GalleryImage> FilteredImages =>
        selectedFilter == "all"
            ? AllImages
            : AllImages.Where(img => img.CategoryId == selectedFilter);

    private string GetDelay()
    {
        _delayCounter += 50;
        if (_delayCounter > 300) _delayCounter = 50;
        return _delayCounter.ToString();
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Pequeño delay para asegurar que el DOM esté listo
            await Task.Delay(100);

            try
            {
                // Inicializar PhotoSwipe para la galería
                await JS.InvokeVoidAsync("initPSWP", "#pswp-gallery");
            }
            catch (Exception ex)
            {
                // Log opcional: el PhotoSwipe puede no estar disponible en primera carga
                Console.WriteLine($"PhotoSwipe init warning: {ex.Message}");
            }
        }
    }
}